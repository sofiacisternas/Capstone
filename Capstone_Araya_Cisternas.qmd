---
title: "Caracterización de las personas según su nivel de apoyo a la democracia"
author: "Juan Araya, Sofía Cisternas"
date: "`r format(Sys.Date())`"
lang: es
execute:
  echo: TRUE
  message: FALSE
  warning: FALSE
format:
  html:
    theme:
      light: cosmo
      dark: darkly
    toc: TRUE
    toc-depth: 3
    number-sections: TRUE
    code-fold: TRUE
    code-copy: TRUE
    code-tools: TRUE
    smooth-scroll: TRUE
---

```{r}
#| label: Liberías
#| include: FALSE
rm(list = ls())

library(dplyr)
library(ggplot2)
library(skimr)
library(readxl)
library(stringr)
library(png)
library(grid)
library(plotly)
library(rpart)
library(rpart.plot)
library(party)
library(labelled)
```

# Problematización

El Instituto Internacional para la Democracia y la Asistencia Electoral (IDEA Internacional) evalúa el desempeño democrático de 173 países a lo largo de los años por medio de la medición de diversos indicadores ligados al Estado de Derecho, la representación, participación y a los derechos humanos. Dichos indicadores se categorizan y contemplan los siguientes factores (IDEA Internacional, 2025):

```{r}
#| label: Indicadores de rendimiento democrático
#| echo: FALSE

png <- "https://raw.githubusercontent.com/sofiacisternas/Capstone/main/Indicadores%20IDEA.png"

download.file(png, destfile = "indicadores.png", mode = "wb")

img <- readPNG("indicadores.png")
grid.raster(img)
```
*Fuente: IDEA Internacional, 2025.*

Los indicadores provienen de 22 fuentes de datos diferentes y se analizan en conjunto con datos cualitativos centrados en eventos sobre el desarrollo de la democracia en los países analizados (IDEA Internacional, 2025).

Con base a dichos datos, IDEA Internacional elabora un informe denominado como “El Estado Global de la Democracia”, en el cual se concentra el análisis efectuado y se emiten conclusiones a partir de los avances o retrocesos en indicadores fundamentales para el desarrollo democrático. En la última versión publicada, correspondiendo a las mediciones ejecutadas durante 2024, se evidenció que 54% (94) de los países han sufrido un deterioro en al menos uno de los factores en comparación con su desempeño hace cinco años. Contrariamente, solo el 32% (55) demostró avances en al menos uno de los factores en el mismo periodo (IDEA Internacional, 2025).

Asimismo, las tendencias globales han demostrado que las libertades civiles fueron uno de los factores que más deterioro experimentó, impactando aspectos como la libertad de prensa, libertad de expresión, igualdad económica y acceso a la justicia. Sin embargo, se observaron avances los indicadores relacionados con la ausencia de corrupción, acceso a la justicia y elecciones creíbles (IDEA Internacional, 2025).

Chile, por su parte, se caracteriza por tener un alto desempeño en las cuatro categorías analizadas, pero especialmente en materia de Representación (0,88/1) y Estado de Derecho (0,73/1). En este sentido, el país está dentro del 25% de los países con mejor desempeño a nivel global, demostrando avances significativos en integridad y seguridad personal, libertades civiles y acceso a la justicia (IDEA Internacional, s.f.).

A pesar del estable posicionamiento del país en materia democrática, se ha evidenciado una baja confianza de la ciudadanía hacia las instituciones políticas y de representación. La Encuesta CEP N°95, correspondiente a septiembre-octubre 2025, los partidos políticos y el Congreso Nacional son las instituciones evaluadas con menor nivel de confianza, alcanzando una puntuación de solo el 3% y 8% respectivamente. Similarmente, la encuesta evidencia que un 61% de las personas considera que la situación política en Chile está mala o muy mala, en contrate con el 10% que opina que está buena o muy buena. Sin embargo, solo un 19% opina que la democracia en el país funciona mal o muy mal (Encuesta CEP N°95, 2025).

Por tanto, se vuele relevante analizar cómo se caracterizan las personas según su nivel de apoyo a la democracia según factores sociodemográficos, niveles de participación política y percepciones ciudadanas e institucionales. Debido a que, algunos académicos han argumentado que el apoyo de la ciudadanía hacia la democracia se mide en gran parte por la capacidad de “delivery” de este tipo de régimen, es decir, por la capacidad de las instituciones de generar resultados concretos en la vida de las personas (Escudero, 2025). Asimismo, se ha señalado que la desafección ciudadana funciona como una antesala al autoritarismo, donde dicha desafección tiende a manifestarse cuando las personas sienten que el régimen democrático no resuelve sus necesidades básicas ni garantiza sus derechos (Leibe, 2025).

# Pregunta de análisis

Considerando el contexto global de deterioro democrático y la combinación en Chile de altos niveles de desempeño democrático con bajos niveles de confianza institucional, surge la siguiente pregunta de investigación: ¿De qué manera las características sociodemográficas, los niveles de participación política y las percepciones ciudadanas e institucionales ayudan a predecir el nivel de apoyo a la democracia de las personas en Chile mediante un modelo de Random Forest?

# Objetivo general del proyecto

Identificar y analizar las diferentes características personales que permiten clasificar a las personas de acuerdo con su nivel de apoyo a la democracia (alto, medio, bajo) utilizando variables de participación política, percepciones cívicas e institucionales y características sociodemográficas mediante un modelo de Random Forest para evaluar su capacidad predictiva y la importancia relativa de cada variable por utilizar.

# Fuente de datos y variables a utilizar

A fin de caracterizar a las personas según su nivel de apoyo a la democracia, se utilziará el estudio de opinión pública desarrollado por Latinobarómetro en su versión correspondiente al año 2024, específicamente la base de datos que únicamente contiene la información de Chile.

```{r}
#| label: Cargar base de datos

#Cargar url que contiene la BBDD
url <- "https://raw.githubusercontent.com/sofiacisternas/Capstone/main/F00018328-Latinobarometro_2024_Chile_Excel_esp_v1.xlsx"

#Crear archivo
archivo <- tempfile(fileext = ".xlsx")

#Descargar archivo
download.file(url, archivo, mode = "wb")

#Archivo como DF
latinobarometro <- read_excel(archivo)

```

```{r}
#| label: Limpiar base de datos para posteriormente filtrar

limpieza <- latinobarometro %>%
  rename_with(~ str_extract(., "^[^ :]+"))
```

```{r}
#| label: Filtrar base

base <- limpieza %>% 
  dplyr::select(
    #Variable dependiente
    P11STGBS,
    
    #Participación política
    P26ST,
    P38STGBS,
    P44ST,
    P36STGBS,
    
    #Percepciones cívicas / institucionales
    P2ST,
    P17ST,
    P25ST,
    P54N,
    
    # Sociodemográficas
    P16ST,
    S1,
    S2,
    REEDAD,
    SEXO)
```

## Variables del modelo

Con el propósito de medir el nivel de apoyo a la democracia, la participación política, las percpeciones cívicas e institucionales y las características sociodemográficas de las personas, se utilizaran las variables descritas a continuación:

### Variable dependiente
P11STGBS. "¿Con cuál de las siguientes frases está Ud. más de acuerdo?" (La democracia es preferible a cualquier otra forma de gobierno = 1, En algunas circunstancias, un gobierno autoritario puede ser preferible a uno democrático = 2, A la gente como uno le da lo mismo un régimen democrático que uno no democrático = 3)

### Variables independientes
#### Participación política
- P26ST. "¿Cuál frase está más cerca de su manera de pensar?" (La manera como uno vota puede hacer que las cosas sean diferentes en el futuro = 1, No importa cómo uno vote, no hará que las cosas sean mejor en el futuro = 2)
- P38STGBS. "¿Hay algún partido político hacia el cual se sienta usted más cercano que hacia el resto de los partidos?" (Sí = 1, No = 2)
- P44ST. "¿Dónde suele Ud. expresar sus opiniones sobre los problemas del país o Ud. no suele hacerlo?" (Manifestación/protesta = 1, Redes sociales = 2, Entre amigos = 3, En familia = 4, No suelo hacerlo = 5)
- P36STGBS. "¿Cuán interesado está Ud. en la política?" (Muy interesado = 1, Algo interesado = 2, Poco interesado = 3, Nada interesado = 4)

#### Percepciones cívicas / institucionales
- P2ST. "¿Diría Ud. que este país...?" (Está progresando = 1, Está estancado = 2, Está en retroceso = 3)
- P54N. "En una escala donde 00 es para nada corrupto y 10 totalmente corrupto, ¿cuán corrupto cree Ud. que es el país?" (Escala 00–10)
- P25ST. "¿Usted se siente políticamente representado en el parlamento/congreso?" (Sí = 1, No = 2)
- P17ST. "¿Cuán justa cree Ud. que es la distribución del ingreso en el país?" (Muy justa = 1, Justa = 2, Injusta = 3, Muy injusta = 4)

#### Sociodemográficas
- P16ST. "En una escala donde 00 es izquierda y 10 es derecha, ¿dónde se ubicaría Ud.?" (Escala 00–10)
- S1. "¿Cuál es su religión?" (Respuesta abierta)
- S2. "¿Ud. se describiría como perteneciendo a la clase...? (Alta = 1, Media alta = 2, Media = 3, Media baja = 4, Baja = 5)
- "Recodificación Edad" (16-25 = 1, 26-40 = 2, 41-60 = 3, 61 y más = 4)
- "Sexo" (Hombre = 1, Mujer = 2)

```{r}
#| label: Asignación de etiquetas a valores

base <- base %>% 
  set_value_labels(
    P11STGBS = c(
      "Alto" = 1,
      "Bajo" = 2,
      "Medio" = 3),
    
    P26ST = c(
      "El voto puede cambiar las cosas" = 1,
      "El voto no cambia las cosas" = 2),
    
    P38STGBS = c(
      "Sí" = 1,
      "No" = 2),
    
    P44ST = c(
      "Manifestación o protesta" = 1,
      "Redes sociales" = 2,
      "Entre amigos" = 3,
      "En familia" = 4,
      "No suele hacerlo" = 5),
    
    P36STGBS = c(
      "Muy interesado" = 1,
      "Algo interesado" = 2,
      "Poco interesado" = 3,
      "Nada interesado" = 4),
    
    P2ST = c(
      "Está progresando" = 1,
      "Está estancado" = 2,
      "Está en retroceso" = 3),
    
    P25ST = c(
      "Sí" = 1,
      "No" = 2),
    
    P17ST = c(
      "Muy justa" = 1,
      "Justa" = 2,
      "Injusta" = 3,
      "Muy injusta" = 4),
    
    S2 = c(
      "Alta" = 1,
      "Media alta" = 2,
      "Media" = 3,
      "Media baja" = 4,
      "Baja" = 5),
    
    REEDAD = c(
      "16–25 años" = 1,
      "26–40 años" = 2,
      "41–60 años" = 3,
      "61 años o más" = 4),
    
    SEXO = c(
      "Hombre" = 1,
      "Mujer" = 2)
    )
```


# Análisis exploratorio y descriptivo
En primer lugar, para poder analizar las variables y su distribución, es necesario realizar una serie de modificaciones, a fin de facilitar el tratamiento de los datos y de interpretación de resultados.
## Observación inicial de base filtrada

```{r}
#| label: Primera visualización base final
#| include: FALSE

summary(base)
skim(base)
```

## Modificación de variables
Para realizar el análisis deseado, en primer lugar se asigna como valor perdido todos aquellos casos en los cuales se contemple los números -5, -2 y -1. Adicionalmente, en la variable P16ST también se asigna como valor perdido en número 97. Esto se debe a que en la variable de religión, este valor corresponde a aquellas personas que establecieron no identificarse con ninguna religión.

Asimismo, la variable P16ST (espectro político) es recodificada para categorizarse en tres valores principales y fácilitar el análisis, donde los valores del 0 al 3 representan una representación en el espectro político con tendencia izquierdista, los valores del 4 al 6 una tendencia más de centro, y los valores del 7 al 10 como una identificación de tendencia hacia la derecha. 

Por otra parte, la variable S1 (identificación religiosa) se recodifica a fin de agrupar a las personas en dos categorías: identificación religiosa y sin identificación religiosa.

Finalmente, cabe establecer que, si bien la variable que se utilizará para calcular el nivel de apoyo a la democracia no es recodificada ni se le asignan nuevas etiquetas, sus valores (1 al 3) se interpretarán de la siguiente manera:

- Nivel Alto = 1 "La democracia es preferible a cualquier otra forma de gobierno" 
- Nivel Medio = 3 "A la gente como uno le da lo mismo un régimen democrático que uno no democrático"
- Nivel Bajo = 2 "En algunas circunstancias, un gobierno autoritario puede ser preferible a uno democrático"

```{r}
#| label: Recodificación

df <- base %>%
  #Valores perdidos por NA
  mutate(across(
    everything(),
    ~ ifelse(. %in% c(-5, -2, -1), NA, .)
  )) %>%
  #P16ST - Espectro político
  mutate(
    RP16 = case_when(
      P16ST %in% c(0, 1, 2, 3) ~ 1, #Izquierda
      P16ST %in% c(4, 5, 6) ~ 2, #Centro
      P16ST %in% c(7, 8, 9, 10) ~ 3, #Derecha
      P16ST == 97 ~ NA_real_
    )) %>%
  
  #S1 - Identificación religiosa
  mutate(
    RS1 = case_when(
      S1 == 97 ~ 2, #Sin identificación religiosa
      TRUE ~ 1 #Identificación religiosa
    )) %>%
  #Etiquetas nuevas variables
  set_value_labels(
    RP16 = c(
      "Izquierda" = 1,
      "Centro"    = 2,
      "Derecha"   = 3),
    
    RS1 = c(
      "Identificación religiosa" = 1,
      "Sin identificación religiosa" = 2)
  ) %>% 
  filter(!is.na(P11STGBS))
```

## Distribución de variables

En la siguiente sección se presenta un análisis descriptivo de algunas de las variables a utilizar, para comprender cómo se distribuyen las distintas observaciones. 

En primer lugar, se puede observar que la mayoría de las personas encuestadas (817 de 1.165) presentan un alto nivel de apoyo a la democracia, mientras que el nivel con menos cantidad de respuestas corresponde a un apoyo bajo. Asimismo, se evidencia una distribución similar entre sexos, donde la diferencia es de 29 casos, favoreciendo a las mujeres; y que existe una mayor concentración en los rangos etarios de 26 a 40 años y de 41 a 60 años. En tanto, son pocas las personas que declaran estar altamente interesadas en la política; y un porcentaje significativo de personas considera que el país se encuentra estancado.
<br><br>
***Distribución por nivel de apoyo a la democracia***
```{r}
#Tabla
t1 <- data.frame(
  Categoria = c("Alto", "Bajo", "Medio"),
  Frecuencia = as.vector(table(df$P11STGBS)),
  Porcentaje = round(100 * as.vector(table(df$P11STGBS)) / length(df$P11STGBS), 1)
)

#Visualización
t1
```
<br>

***Distribución por sexo***
```{r}
#Tabla
t2 <-  data.frame(
  Categoria = c("Hombre", "Mujer"),                
  Frecuencia = as.vector(table(df$SEXO)),      
  Porcentaje = round(100 * as.vector(table(df$SEXO)) / length(df$SEXO), 1)
  )

#Visualización
t2
```
<br>
***Distribución por rango etario***
```{r}
#Tabla
t3 <- data.frame(
  Categoria = c("16-25", "26-40", "41-60", "61 o más"),
  Frecuencia = as.vector(table(df$REEDAD)),
  Porcentaje = round(100 * as.vector(table(df$REEDAD)) / length(df$REEDAD), 1)
)

#Visualización
t3
```
<br>
***Distribución por interés en la política***
```{r}
#Tabla
t4 <- data.frame(
  Categoria = c("Muy interesado", "Algo interesado", "Poco interesado", "Nada interesado"),
  Frecuencia = as.vector(table(df$P36STGBS)),
  Porcentaje = round(100 * as.vector(table(df$P36STGBS)) / length(df$P36STGBS), 1)
)

#Visualización
t4
```
<br>
***Distribución por percpeción de progeso del país***
```{r}
#Tabla
t5 <- data.frame(
  Categoria = c("Está progresando", "Está estancado", "Está en retroceso"),
  Frecuencia = as.vector(table(df$P2ST)),
  Porcentaje = round(100 * as.vector(table(df$P2ST)) / length(df$P2ST), 1)
)

#Visualización
t5
```
<br>
En cambio, al observar la distribución de dichas variables independientes en relación con su nivel de apoyo a la democracia se puede apreciar que, hay más mujeres que hombres entre quienes presentan tanto un alto como medio nivel a la democracia, representando un 52,9% y 50,8% respectivamente. Contrariamente, los hombres concentran el 56,4% de los casos entre quienes presentan un bajo nivel de apoyo a la democracia.
```{r}
#| label: Gráfico sexo según nivel de apoyo a la democracia

demo_sexo <- df %>%
  group_by(P11STGBS, SEXO) %>%
  summarise(Conteo = n(), .groups = "drop") %>%
  group_by(P11STGBS) %>%
  mutate(Porcentaje = Conteo / sum(Conteo) * 100,
         P11STGBS = factor(P11STGBS, levels = c(1, 2, 3), labels = c("Alto", "Bajo", "Medio")),
         SEXO = factor(SEXO, levels = c(1, 2), labels = c("Hombre", "Mujer"))) %>%  
  ggplot(aes(x = P11STGBS, y = Porcentaje, fill = SEXO)) +
  geom_bar(stat = "identity", position = "fill", color = "black") +  
  coord_flip() + 
  labs(
    title = "Sexo según nivel de apoyo a la democracia",
    x = "Apoyo a la democracia",  
    y = "Porcentaje",
    fill = "Sexo"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right", 
    plot.title = element_text(hjust = 0.5),  
    axis.text.x = element_blank(),   
    axis.ticks.x = element_blank()   
  ) +
  geom_text(
    aes(label = scales::percent(Porcentaje / 100, accuracy = 0.1)),  
    position = position_fill(vjust = 0.5), 
    color = "white"
  )


ggplotly(demo_sexo, tooltip = "text")
```
<br>
Al analizar los rangos etarios según el nivel de apoyo a la democracia, se puede observar que no existe una tendencia claramente diferenciada entre los grupos, pues en los tres niveles la distribución de los rangos es similar. 
```{r}
#| label: Gráfico rango etario según nivel de apoyo a la democracia

demo_edad <- df %>%
  group_by(P11STGBS, REEDAD) %>%
  summarise(Conteo = n(), .groups = "drop") %>%
  group_by(P11STGBS) %>%
  mutate(Porcentaje = Conteo / sum(Conteo) * 100,
         P11STGBS = factor(P11STGBS, levels = c(1, 2, 3), labels = c("Alto", "Bajo", "Medio")),
         REEDAD = factor(REEDAD, levels = c(1, 2, 3, 4), labels = c("16-25", "26-40", "41-60", "61+"))) %>%  
  ggplot(aes(x = P11STGBS, y = Porcentaje, fill = REEDAD)) +
  geom_bar(stat = "identity", position = "fill", color = "black") +  
  coord_flip() + 
  labs(
    title = "Rango etario según nivel de apoyo a la democracia",
    x = "Apoyo a la democracia",  
    y = "Porcentaje",
    fill = "Edad"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right", 
    plot.title = element_text(hjust = 0.5),  
    axis.text.x = element_blank(),   
    axis.ticks.x = element_blank()   
  ) +
  geom_text(
    aes(label = scales::percent(Porcentaje / 100, accuracy = 0.1)),  
    position = position_fill(vjust = 0.5), 
    color = "white"
  )


ggplotly(demo_edad, tooltip = "text")
```
<br>
En cuanto al nivel de interés en la política, el gráfico evidencia que, gran parte de quienes presentan un apoyo medio a la democracia no están nada interesados en la política, representando el 53%. En cambio, existe una concentración similar entre los niveles Alto y Bajo de quienes declaran estar algo y poco interesados.
```{r}
#| label: Gráfico interés en la política según nivel de apoyo a la democracia

demo_pol <- df %>%
  filter(!is.na(P36STGBS)) %>%
  group_by(P11STGBS, P36STGBS) %>%
  summarise(Conteo = n(), .groups = "drop") %>%
  group_by(P11STGBS) %>%
  mutate(Porcentaje = Conteo / sum(Conteo) * 100,
         P11STGBS = factor(P11STGBS, levels = c(1, 2, 3), labels = c("Alto", "Bajo", "Medio")),
         P36STGBS = factor(P36STGBS, levels = c(1, 2, 3, 4), labels = c("Muy interesado", "Algo interesado",
                                                                        "Poco interesado", "Nada interesado"))) %>%  
  ggplot(aes(x = P11STGBS, y = Porcentaje, fill = P36STGBS)) +
  geom_bar(stat = "identity", position = "fill", color = "black") +  
  coord_flip() + 
  labs(
    title = "Interés en la política según nivel de apoyo a la democracia",
    x = "Apoyo a la democracia",  
    y = "Porcentaje",
    fill = "Edad"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right", 
    plot.title = element_text(hjust = 0.5),  
    axis.text.x = element_blank(),   
    axis.ticks.x = element_blank()   
  ) +
  geom_text(
    aes(label = scales::percent(Porcentaje / 100, accuracy = 0.1)),  
    position = position_fill(vjust = 0.5), 
    color = "white"
  )


ggplotly(demo_pol, tooltip = "text")
```
<br>
En contraste a los gráficos previamente presentados, se puede observar entre quienes presentan un alto nivel de apoyo a la democracia predomina la percepción de que el país está  estancado (51,3%), seguida por la idea de que se encuentra en progreso (31,9%). Por el contrario, entre quienes presentan un bajo apoyo a la democracia, un 44,5% opina que el país está en retroceso. Finalmente, en el grupo con apoyo medio a la democracia también prevalece la percepción de estancamiento, con un 46,4%, seguida por el 42,5% que considera que el país está en retroceso.

```{r}
#| label: Gráfico percepción situación países según nivel de apoyo a la democracia

demo_sit <- df %>%
  filter(!is.na(P2ST)) %>%
  group_by(P11STGBS, P2ST) %>%
  summarise(Conteo = n(), .groups = "drop") %>%
  group_by(P11STGBS) %>%
  mutate(Porcentaje = Conteo / sum(Conteo) * 100,
         P11STGBS = factor(P11STGBS, levels = c(1, 2, 3), labels = c("Alto", "Bajo", "Medio")),
         P2ST = factor(P2ST, levels = c(1, 2, 3), labels = c("Está progresando", "Está estancado",
                                                                        "Está en retroceso"))) %>%  
  ggplot(aes(x = P11STGBS, y = Porcentaje, fill = P2ST)) +
  geom_bar(stat = "identity", position = "fill", color = "black") +  
  coord_flip() + 
  labs(
    title = "Apoyo a la democracia por opinión país",
    x = "Apoyo a la democracia",  
    y = "Porcentaje",
    fill = "Opinión país"
  ) +
  theme_minimal() +
  theme(
    legend.position = "right", 
    plot.title = element_text(hjust = 0.5),  
    axis.text.x = element_blank(),   
    axis.ticks.x = element_blank()   
  ) +
  geom_text(
    aes(label = scales::percent(Porcentaje / 100, accuracy = 0.1)),  
    position = position_fill(vjust = 0.5), 
    color = "white"
  )


ggplotly(demo_sit, tooltip = "text")
```

# Árbol de decisión y Random Forest

## Árbol de decisión
El siguiente árbol de decisión busca clasificar y caracterizar a las personas según su nivel de apoyo a la democracia (P11STGBS) según variables de participación política, percepciones cívicas e institucionales y características sociodemográficas. 

Se puede observar que la creencia sobre la eficacia del voto (P26ST) es la variable más relevante entre todas las seleccionadas. En este sentido, entre quienes creen que su voto puede cambiar el futuro muestran un nivel de apoyo más alto, reforzándose aún más si no perciben que el país está retorcediendo (P2ST), además de tener cierto perfil respecto a los espacios en los cuales expresan su opinión sobre el país (P44ST).

Adicionalmente, se evidencia que el nivel de apoyo a la democracia también se podría explicar con variables como el sexo, la clase social percibida (S2), los lugares donde se expresa la opinión sobre el país (P44ST) y la percepción de corrupción (P54N).

```{r}
#| label: Árbol de decisión

set.seed(15097)

ar <- rpart(
  P11STGBS ~ 
    # Participación política
    P26ST + 
    P38STGBS + 
    P44ST + 
    P36STGBS +
    
    # Percepciones cívicas / institucionales
    P2ST + 
    P54N + 
    P25ST + 
    P17ST +
    
    # Sociodemográficas
    RP16 + 
    RS1 + 
    S2 + 
    REEDAD + 
    SEXO,
  
  method = "class",
  control = rpart.control(minbucket = 25, cp = 0),
  data = df
)


print(ar, digits = 4)
```

```{r}
#| label: Gráficar árbol de regresión
#| message: FALSE
#| warning: FALSE

cols <- ifelse(ar$frame$yval == 1, "gray1", "hotpink")

prp(ar, main = "Nivel de apoyo a la democracia", 
    extra = 104,
    nn = TRUE,  
    fallen.leaves = TRUE, 
    branch = .5, 
    faclen = 0, 
    trace = 1,
    shadow.col = "gray",
    branch.lty = 1,
    branch.type = 5, 
    split.cex = 1.2, 
    split.prefix = "es ", 
    split.suffix = "?", 
    col = cols, 
    border.col = cols, 
    split.box.col = "lightgray",
    split.border.col = "darkgray",
    split.round = 0.5) 
```

## Random forest

```{r}
#| label: Random forest

df$P11STGBS <- as.factor(df$P11STGBS)

crf.df <- cforest(
  P11STGBS ~ 
    # Participación política
    P26ST + 
    P38STGBS + 
    P44ST + 
    P36STGBS +
    
    # Percepciones cívicas / institucionales
    P2ST + 
    P54N + 
    P25ST + 
    P17ST +
    
    # Sociodemográficas
    RP16 + 
    RS1 + 
    S2 + 
    REEDAD + 
    SEXO,
  
  controls = cforest_control(
    ntree = 500,
    mincriterion = qnorm(0.8),
    trace = TRUE
  ),
  
  data = df
)

crf.df
```

```{r}
crf.df.prob <- predict(crf.df, newdata = df, type = "prob")
dim(crf.df.prob)
```

```{r}
head(crf.df.prob)
```


```{r}
crf.prob <- matrix(unlist(crf.df.prob), ncol = 3, byrow = TRUE)
head(crf.prob)

apply(crf.prob,2,mean)
```

```{r}
rpart.prob <- predict(ar, newdata = df,type = "prob")
head(rpart.prob)
```

```{r}
out <- data.frame(rpart = rpart.prob[,2],
cforest = crf.prob[,2],
class = ar$where)
names(out)
```

```{r}
out%>%
  group_by(class)%>%
  summarise(rpart = mean(rpart),
            cforest = mean(cforest))
```

```{r}
ggplot(out, aes(x = rpart, y = cforest)) + geom_point()
```

# Conclusiones y recomendaciones

# Referencias

- Centro de Estudio Públicos. (2025).  *Encuesta CEP N°95, Septiembre - Octubre 2025.* https://static.cepchile.cl/uploads/cepchile/2025/10/13-113839_vwlh_ppt95_conferencia_OP_con-anexo_VF_29102025.pdf
- IDEA Internacional. (s.f.). *Chile.* https://www.idea.int/democracytracker/country/chile 
- IDEA Internacional. (2025). *The Global State of Democracy 2025: Democracy on the Move.* https://www.idea.int/publications/catalogue/global-state-of-democracy-2025-democracy-on-the-move?lang=en
- Universidad de Chile. (2025). *Los ejes del debate sobre la democracia: Deterioro global y crisis del “delivery”.* https://gobierno.uchile.cl/noticias/233404/los-ejes-del-debate-sobre-la-democracia-deterioro-global-y-crisis
